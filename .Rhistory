knitr::opts_chunk$set(echo = TRUE)
options(scipen = 11111)
library(tidyverse) # Data manipulating
library(FactoMineR) # performing PCA
library(factoextra) # Creating some plot (biplot)
library(plotly) # Interactive plotting
library(tibble) # Creating rownames
library(corrplot) # Creating correlation plot
library(countrycode) #generating continent variable from country code
library(gganimate) #animating plot
mortal_total <- read.csv("source/Population Growth, Fertility and Mortality Indicators.csv")
knitr::opts_chunk$set(echo = TRUE)
options(scipen = 11111)
library(tidyverse) # Data manipulating
library(FactoMineR) # performing PCA
library(factoextra) # Creating some plot (biplot)
library(plotly) # Interactive plotting
library(tibble) # Creating rownames
library(corrplot) # Creating correlation plot
library(countrycode) #generating continent variable from country code
library(gganimate) #animating plot
mortal_total <- read.csv("source/Population Growth, Fertility and Mortality Indicators.csv")
str(mortal_total)
mortal_lastyears <- mortal_total %>%
select(-c(X.3,X.4)) %>%
filter(X == 2015) %>%
spread(key = X.1, value = X.2) %>% # create column for each indicator in X.1
rename(year = X,
Code = T03,
Country = Population.growth.and.indicators.of.fertility.and.mortality,
inf.mort = `Infant mortality for both sexes (per 1,000 live births)`,
life.exp.both = `Life expectancy at birth for both sexes (years)`,
life.exp.male = `Life expectancy at birth for males (years)`,
life.exp.female = `Life expectancy at birth for females (years)`,
maternal.mortality.ratio = `Maternal mortality ratio (deaths per 100,000 population)`,
pop.increase = `Population annual rate of increase (percent)`,
tot.fertil.rate = `Total fertility rate (children per women)`) %>%
mutate(inf.mort = as.numeric(as.character(inf.mort)),
life.exp.both = as.numeric(as.character(life.exp.both)),
life.exp.female = as.numeric(as.character(life.exp.female)),
life.exp.male = as.numeric(as.character(life.exp.male)),
maternal.mortality.ratio = as.numeric(as.character(maternal.mortality.ratio)),
pop.increase = as.numeric(as.character(pop.increase)),
tot.fertil.rate = as.numeric(as.character(tot.fertil.rate)))
head(mortal_lastyears)
mortal_lastyears %>%
is.na() %>%
colSums()
# Assigning the average value of each variables
life.exp.both.avg <- mean(mortal_lastyears$life.exp.both,na.rm = T)
life.exp.male.avg <- mean(mortal_lastyears$life.exp.male, na.rm = T)
life.exp.female.avg <- mean(mortal_lastyears$life.exp.female,na.rm = T)
inf.mort.avg <- mean(mortal_lastyears$inf.mort,na.rm = T)
maternal.mortality.ratio.avg <- mean(mortal_lastyears$maternal.mortality.ratio,na.rm = T)
pop.increase.avg <- mean(mortal_lastyears$pop.increase,na.rm = T)
tot.fertil.rate.avg <- mean(mortal_lastyears$tot.fertil.rate,na.rm = T)
# Replacing the NAs with the avg value
mortal_lastyears <- mortal_lastyears %>%
mutate(inf.mort = replace_na(inf.mort,inf.mort.avg),
life.exp.both = replace_na(life.exp.both,life.exp.both.avg),
life.exp.female = replace_na(life.exp.female,life.exp.female.avg),
life.exp.male = replace_na(life.exp.male,life.exp.male.avg),
maternal.mortality.ratio = replace_na(maternal.mortality.ratio,maternal.mortality.ratio.avg),
pop.increase = replace_na(pop.increase,pop.increase.avg),
tot.fertil.rate = replace_na(tot.fertil.rate,tot.fertil.rate.avg))
head(mortal_lastyears)
# we will create a vector that indicates wether a rows' values are mostly the avg values of each column or not
cb <-
mortal_lastyears$inf.mort == inf.mort.avg &
mortal_lastyears$life.exp.both == life.exp.both.avg &
mortal_lastyears$life.exp.male == life.exp.male.avg &
mortal_lastyears$life.exp.female == life.exp.female.avg &
mortal_lastyears$maternal.mortality.ratio == maternal.mortality.ratio.avg &
mortal_lastyears$tot.fertil.rate == tot.fertil.rate.avg
# join the vector to the data
mortal_lastyears <- cbind(mortal_lastyears, cb)
# eliminating the rows have mostly the average values in its columns
mortal_lastyears <- mortal_lastyears %>%
filter(cb == F)
mortal_lastyears <- mortal_lastyears[,-c(1,3,11)]
str(mortal_lastyears)
mortal_lastyears$Continent <- countrycode(sourcevar = mortal_lastyears[,"Country"],
origin = "country.name",
destination = "continent")
mortal_lastyears <- mortal_lastyears %>%
mutate(Continent = replace_na(Continent, "?"))
mortal_lastyears <- mortal_lastyears %>%
filter(Continent != "?") %>%
mutate(Continent = as.factor(Continent))
mortal_lastyears <- column_to_rownames(mortal_lastyears,"Country")
corrplot(cor(mortal_lastyears[,-8]), method = "circle")
mortal_lastyears <- mortal_lastyears[,-c(3,4)]
g <- ggplot(mortal_lastyears, aes(life.exp.both, inf.mort, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(aes(group = 1), method = loess)+
theme_classic()
ggplotly(g)
g6 <- ggplot(mortal_lastyears, aes(life.exp.both, pop.increase, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(aes(group = 1), method = loess)+
theme_classic()
ggplotly(g6)
g7 <- ggplot(mortal_lastyears, aes(life.exp.both, maternal.mortality.ratio.avg, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(aes(group = 1), method = loess)+
theme_classic()
ggplotly(g7)
g8 <- ggplot(mortal_lastyears, aes(life.exp.both, tot.fertil.rate, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(aes(group = 1), method = loess)+
theme_classic()
ggplotly(g8)
g1 <- ggplot(mortal_lastyears, aes(tot.fertil.rate,life.exp.both, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(method = loess, aes(group = 1))+
theme_classic()
ggplotly(g1)
g2 <- ggplot(mortal_lastyears, aes(tot.fertil.rate,inf.mort, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(method = loess, aes(group = 1))+
theme_classic()
ggplotly(g2)
g3 <- ggplot(mortal_lastyears, aes(tot.fertil.rate,maternal.mortality.ratio, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(method = loess, aes(group = 1))+
theme_classic()
ggplotly(g3)
g4 <- ggplot(mortal_lastyears, aes(pop.increase,inf.mort, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(method = loess, aes(group = 1))+
theme_classic()
ggplotly(g4)
g5 <- ggplot(mortal_lastyears, aes(pop.increase,tot.fertil.rate, text = rownames(mortal_lastyears))) +
geom_jitter(aes(col = Continent)) +
geom_smooth(method = loess, aes(group = 1))+
theme_classic()
ggplotly(g5)
mortal_lastyears_scaled <- scale(mortal_lastyears[,-6])
summary(mortal_lastyears_scaled)
wss <- function(data, maxCluster = 9) {
# Initialize within sum of squares
SSw <- (nrow(data) - 1) * sum(apply(data, 2, var))
for (i in 2:maxCluster) {
set.seed(10)
SSw[i] <- sum(kmeans(data, centers = i)$withinss)
}
plot(1:maxCluster, SSw, type = "o", xlab = "Number of Clusters", ylab = "Within groups sum of squares", pch=19)
}
wss(mortal_lastyears_scaled)
set.seed(11)
mortal_cluster2 <- kmeans(mortal_lastyears_scaled,2)
mortal_cluster3 <- kmeans(mortal_lastyears_scaled,3)
table(mortal_cluster2$cluster)
table(mortal_cluster3$cluster)
mortal_lastyears$clust2 <- factor(mortal_cluster2$cluster)
mortal_lastyears$clust3 <- factor(mortal_cluster3$cluster)
mortal_pca <- PCA(mortal_lastyears_scaled, graph = F)
mortal_pca_pr <- prcomp(mortal_lastyears_scaled)
mortal_pca$eig
fviz_screeplot(mortal_pca)
fviz_contrib(mortal_pca_pr, choice = "var", axes = 1)
fviz_contrib(mortal_pca_pr, choice = "var", axes = 2)
fviz_pca_var(mortal_pca_pr,
col.var = "contrib",
gradient.cols = c("pink", "red", "black") ,
repel = T)
fviz_cluster(mortal_cluster2,
data = mortal_lastyears_scaled,
labelsize = 5,
repel = T)
fviz_pca_var(mortal_pca_pr,
col.var = "contrib",
gradient.cols = c("pink", "red", "black") ,
repel = T)
pr <- prcomp(mortal_lastyears_scaled)
mortal_arrow <- data.frame(pr$rotation)
mortal_pr_c2 <- data.frame(pr$x,
clust = factor(mortal_cluster2$cluster),
continent = mortal_lastyears$Continent,
country = factor(rownames(mortal_lastyears)),
inf.mort = mortal_lastyears$inf.mort,
life.exp.both = mortal_lastyears$life.exp.both,
maternal.mort.ratio = mortal_lastyears$maternal.mortality.ratio,
pop.increase = mortal_lastyears$pop.increase,
tot.fertil.rate = mortal_lastyears$tot.fertil.rate)
mortal_pr_c2 <- mortal_pr_c2 %>%
mutate(text = paste('clust :', factor(mortal_cluster2$cluster),
'
continent :' ,mortal_lastyears$Continent,
'
country :' ,factor(rownames(mortal_lastyears)),
'
inf.mort :' ,mortal_lastyears$inf.mort,
'
life.exp.both :' , mortal_lastyears$life.exp.both,
'
maternal.mort.ratio :', mortal_lastyears$maternal.mortality.ratio,
'
pop.increase :', mortal_lastyears$pop.increase,
'
tot.fertil.rate :', mortal_lastyears$tot.fertil.rate))
po <- ggplot(mortal_pr_c2, aes(PC1,PC2, text = text ))+
geom_hline(aes(yintercept=0), size=.2, alpha = 0.5, linetype = 2) +
geom_vline(aes(xintercept=0), size=.2, alpha = 0.5, linetype = 2)+
geom_point(aes(col = clust, pch = continent)) +
theme_classic()
ggplotly(po, tooltip = 'text')
fviz_cluster(mortal_cluster3,
data = mortal_lastyears_scaled,
labelsize = 5,
repel = T)
fviz_pca_var(mortal_pca_pr,
col.var = "contrib",
gradient.cols = c("pink", "red", "black") ,
repel = T)
mortal_pr_c3 <- data.frame(pr$x,
clust = factor(mortal_cluster3$cluster),
continent = mortal_lastyears$Continent,
country = factor(rownames(mortal_lastyears)),
inf.mort = mortal_lastyears$inf.mort,
life.exp.both = mortal_lastyears$life.exp.both,
maternal.mort.ratio = mortal_lastyears$maternal.mortality.ratio,
pop.increase = mortal_lastyears$pop.increase,
tot.fertil.rate = mortal_lastyears$tot.fertil.rate)
mortal_pr_c3 <- mortal_pr_c3 %>%
mutate(text = paste('clust :', factor(mortal_cluster3$cluster),
'
continent :' ,mortal_lastyears$Continent,
'
country :' ,factor(rownames(mortal_lastyears)),
'
inf.mort :' ,mortal_lastyears$inf.mort,
'
life.exp.both :' , mortal_lastyears$life.exp.both,
'
maternal.mort.ratio :', mortal_lastyears$maternal.mortality.ratio,
'
pop.increase :', mortal_lastyears$pop.increase,
'
tot.fertil.rate :', mortal_lastyears$tot.fertil.rate))
po <- ggplot(mortal_pr_c3, aes(PC1,PC2, text = text ))+
geom_hline(aes(yintercept=0), size=.2, alpha = 0.5, linetype = 2) +
geom_vline(aes(xintercept=0), size=.2, alpha = 0.5, linetype = 2)+
geom_point(aes(col = clust, pch = continent)) +
theme_classic()
ggplotly(po, tooltip = 'text')
mortal_allyears <- mortal_total %>%
select(-c(X.3,X.4)) %>%
filter(Population.growth.and.indicators.of.fertility.and.mortality %in% rownames(mortal_lastyears)) %>%
spread(key = X.1, value = X.2) %>% # create column for each indicator in X.1
rename(year = X,
Code = T03,
Country = Population.growth.and.indicators.of.fertility.and.mortality,
inf.mort = `Infant mortality for both sexes (per 1,000 live births)`,
life.exp.both = `Life expectancy at birth for both sexes (years)`,
maternal.mortality.ratio = `Maternal mortality ratio (deaths per 100,000 population)`,
pop.increase = `Population annual rate of increase (percent)`,
tot.fertil.rate = `Total fertility rate (children per women)`) %>%
mutate(inf.mort = as.numeric(as.character(inf.mort)),
life.exp.both = as.numeric(as.character(life.exp.both)),
maternal.mortality.ratio = as.numeric(as.character(maternal.mortality.ratio)),
pop.increase = as.numeric(as.character(pop.increase)),
tot.fertil.rate = as.numeric(as.character(tot.fertil.rate)))
str(mortal_allyears)
# adding continent
mortal_allyears$Continent <- countrycode(sourcevar = mortal_allyears[,"Country"],
origin = "country.name",
destination = "continent")
mortal_allyears <- mortal_allyears %>%
filter(Continent != "?") %>%
select( -c("Code","Life expectancy at birth for females (years)", "Life expectancy at birth for males (years)")) %>%
mutate(Continent = as.factor(Continent))
mortal_allyears %>%
is.na() %>%
colSums()
# assigning a rownames from Country var.
mortal_lastyears$Country <- rownames(mortal_lastyears)
#creating a new dataframe to merge its cluster to the data.
country_cluster <- mortal_lastyears %>%
select(c("Country","clust2","clust3"))
mortal_allyears <- merge(country_cluster,mortal_allyears,by = "Country")
#replacing NAs with avg value
mortal_allyears %>%
is.na() %>%
colSums()
life.exp.both.avg.2 <- mean(mortal_allyears$life.exp.both,na.rm = T)
life.exp.male.avg.2 <- mean(mortal_allyears$life.exp.male, na.rm = T)
life.exp.female.avg.2 <- mean(mortal_allyears$life.exp.female,na.rm = T)
inf.mort.avg.2 <- mean(mortal_allyears$inf.mort,na.rm = T)
maternal.mortality.ratio.avg.2 <- mean(mortal_allyears$maternal.mortality.ratio,na.rm = T)
pop.increase.avg.2 <- mean(mortal_allyears$pop.increase,na.rm = T)
tot.fertil.rate.avg.2 <- mean(mortal_allyears$tot.fertil.rate,na.rm = T)
mortal_allyears <- mortal_allyears %>%
mutate(inf.mort = replace_na(inf.mort,inf.mort.avg.2),
life.exp.both = replace_na(life.exp.both,life.exp.both.avg.2),
maternal.mortality.ratio = replace_na(maternal.mortality.ratio,maternal.mortality.ratio.avg.2),
pop.increase = replace_na(pop.increase,pop.increase.avg.2),
tot.fertil.rate = replace_na(tot.fertil.rate,tot.fertil.rate.avg.2))
mortal_allyears %>%
is.na() %>%
colSums()
#eliminating some rows
cb2 <-
mortal_allyears$inf.mort == inf.mort.avg.2 &
mortal_allyears$life.exp.both == life.exp.both.avg.2 &
mortal_allyears$maternal.mortality.ratio == maternal.mortality.ratio.avg.2 &
mortal_allyears$tot.fertil.rate == tot.fertil.rate.avg.2 |
mortal_allyears$maternal.mortality.ratio == maternal.mortality.ratio.avg.2
mortal_allyears <- cbind(mortal_allyears, cb2)
mortal_allyears <- mortal_allyears %>%
filter(cb2 == F)
mortal_allyears <-  mortal_allyears[,-11]
str(mortal_allyears)
mortal_allyears_scaled <- scale(mortal_allyears[,-c(1,2,3,4,10)])
summary(mortal_allyears_scaled)
summary(mortal_lastyears_scaled)
pr.2 <-  prcomp(mortal_allyears_scaled,scale. = F)
pr.3 <- PCA(mortal_allyears_scaled, graph = F, scale.unit = F)
mortal_allyears_clust <- data.frame(pr.2$x,
mortal_allyears)
mortal_allyears_clust <-  mortal_allyears_clust %>%
select(c(1,2,6,7,8,9,15)) %>%
filter(year %in% c(2005,2010,2015))
mortal_allyears_clust$year <- as.character(mortal_allyears_clust$year)
mortal_allyears_clust$year <- as.numeric(mortal_allyears_clust$year)
str(mortal_allyears_clust)
ggplot(mortal_allyears_clust, aes(-PC1,-PC2)) +
geom_hline(aes(yintercept=0), size=.2, alpha = 0.8, linetype = 2) +
geom_vline(aes(xintercept=0), size=.2, alpha = 0.8, linetype = 2)+
geom_point(aes(col = clust2, pch = Continent))+
theme_classic() +
transition_time(year,range = c(2005,2015))
fviz_cluster(mortal_cluster2,
data = mortal_lastyears_scaled,
labelsize = 5,
repel = T)
ggplot(mortal_allyears_clust, aes(-PC1,-PC2)) +
geom_hline(aes(yintercept=0), size=.2, alpha = 0.8, linetype = 2) +
geom_vline(aes(xintercept=0), size=.2, alpha = 0.8, linetype = 2)+
geom_point(aes(col = clust2, pch = Continent))+
theme_classic() +
transition_time(year,range = c(2005,2015))
install.packages("gifski")
ggplot(mortal_allyears_clust, aes(-PC1,-PC2)) +
geom_hline(aes(yintercept=0), size=.2, alpha = 0.8, linetype = 2) +
geom_vline(aes(xintercept=0), size=.2, alpha = 0.8, linetype = 2)+
geom_point(aes(col = clust2, pch = Continent))+
theme_classic() +
transition_time(year,range = c(2005,2015))
clust2
mortal_allyears_clust
